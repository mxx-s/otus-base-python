{% extends "root.html" %}
{% load index_tags %}

{% block title %}
     This is root
{% endblock title %}

{% block body %}
<h1>Hello {{ user.username }}</h1>


<ul>
    {% for post in posts %}
        {# Поскольку запрос один, то он выводит много повторяющихся постов. #}
        {# Этим шагом, мы вычисляем, есть ли у поста комменты (т.к. их наличие, результирующий набор постов размножает) #}
        {# Если идентификатор поста с предыдущим не совпадает, значит у нас новый пост и его надо вывести #}
        {% if PostId != post.id %}
         
            {# Тут мы смотрим на существование у предыдущего поста комментов. #}
            {# Если комменты были, то закрываем список, если нет - ничего не делаем #}
            {% if CommentExists %} 
                </ul>
                {# <input type="submit" name="form" value="Submit" /> #}
                {% define False as CommentExists %}
            {% endif %}
            {# Запоминаем текущий идентификатор поста, и выводим пост #}
            {% define post.id as PostId %} 
            <li class="card p-2" type="button" data-bs-toggle="collapse" data-bs-target="#multiCollapseExample{{post.id}}" aria-expanded="false" aria-controls="multiCollapseExample{{post.id}}">{{post.title}}:{{post.body}} Author: {{ post.autor__name }}</li>
            {# Проверяем, есть ли комменты у поста, если есть - открываем список для комментов #}
            {% if post.comment__id is not None %}
                <ul class="collapse multi-collapse card ms-4" id="multiCollapseExample{{post.id}}">
                    <li>{{post.comment__body}}:{{post.comment__author__name}}</li>
                    {% define True as CommentExists%}
            {% else %}
                    <a href="{% url 'comment_create' %} " class="collapse multi-collapse btn btn-outline-primary" id="multiCollapseExample{{post.id}}""> create </a>

                    {% define False as CommentExists%}
            {% endif %}
        {% else %}
            <li>{{post.comment__body}}:{{post.comment__author__name}}</li>
            {{continue}}
        {% endif %}
    {% endfor %}
</ul>

{% endblock body %} 